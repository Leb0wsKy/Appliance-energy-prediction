<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot & Support</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      display: flex;
      height: 100vh;
    }

    .navbar {
      width: 220px;
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .navbar .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
      font-size: 18px;
      color: #222;
    }

    .navbar .logo img {
      height: 25px;
      width: 25px;
    }

    .navbar .menu {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .navbar .menu a {
      display: flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
      color: #333;
      font-size: 14px;
      font-weight: 500;
      padding: 8px;
      border-radius: 6px;
      background: #fcffff;
      color: #777;
    }

    .navbar .menu a:hover {
      background: #f0f0f0;
      color: #007bff;
    }

    .navbar .actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .navbar .actions img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
    }

    .container {
      flex: 1;
      display: flex;
      padding: 30px;
      gap: 30px;
    }

    .chatbot-section {
      flex: 2;
      background: #fff;
      border-radius: 50px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      padding: 30px;
      display: flex;
      flex-direction: column;
      margin-top: 20px;
    }

    .chatbot-section h2 {
      margin: 0 0 10px 0;
      font-size: 26px;
      color: #222;
    }

    .chatbot-section p {
      color: #666;
      font-size: 15px;
      margin: 0;
    }

    .chatbot-section hr {
      border: none;
      height: 2px;
      background-color: #e0e0e0;
      margin: 20px -30px;
      width: calc(100% + 60px);
    }

    .chatbot-box {
      text-align: center;
      margin-top: 70px;
    }

    .bot-img {
      width: 100px;
      margin: 10px 0;
    }

    .chatbot-box h3 {
      margin: 0 0 5px 0;
      font-size: 18px;
      color: #000;
    }

    .chatbot-box p {
      color: #555;
      font-size: 13px;
    }

    .chat-input {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 150px;
      background: #fff;
      border-radius: 30px;
      padding: 5px 10px;
      border: 1px solid #ccc;
    }

    .chat-input input {
      flex: 1;
      padding: 10px;
      border: none;
      outline: none;
      border-radius: 200px;
    }

    .chat-input button, 
    .chat-input .file-btn {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 18px;
      padding: 5px;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .chat-input button:hover, 
    .chat-input .file-btn:hover {
      background: #f0f0f0;
    }

    .chat-input .send {
      background: #007bff;
      color: white;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .sidebar {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
    }

    .support-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 30px;
    }

    .support-card h3 {
      font-size: 20px;
      color: #222;
      margin: 0 0 10px 0;
    }

    .support-link {
      display: block;
      text-decoration: none;
      color: inherit;
      padding: 5px 0;
      border-radius: 10px;
      transition: background 0.2s;
    }

    .support-link:hover {
      background: #f0f0f0;
    }

    .support-link p {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    .support-link .label {
      font-weight: 600;
      font-size: 15px;
    }

    .support-link small {
      display: block;
      margin-left: 50px;
      font-size: 12px;
      color: #777;
    }

    .navbar .menu a img {
      width: 18px;
      height: 18px;
      vertical-align: middle;
    }

    .admin-info {
      margin-top: auto;
      display: flex;
      align-items: center;
      gap: 8px;
      padding-top: 10px;
    }

    .admin-info .admin-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }

    .admin-info .admin-email {
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }

    .navbar .menu a.active {
      color: #005187;
      background: #c4dafa;
      border-radius: 6px;
      border: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="logo">
      <img src="elc.png" alt="Energenius Logo">
      Energenius
    </div>
    <div class="menu">
      <a href="../dashboard/dashboard.html" class="tab"><img src="dashboard.svg" alt="">Dashboard</a>
      <a href="../device/device.html" class="tab"><img src="device.svg" alt="">Devices</a>
      <a href="#" class="tab"><img src="reports.svg" alt="">Reports</a>
      <a href="./chat.html" class="tab active"><img src="AICHATBOT.svg" alt="">Chatbot & Support</a>
      <a href="#" class="tab"><img src="setting.svg" alt="">Settings</a>
    </div>
    <div class="admin-info">
      <img src="admin.png" alt="Admin Icon" class="admin-icon">
      <span class="admin-email">admin@gmail.com</span>
    </div>
  </div>

  <div class="container">
    <div class="chatbot-section">
      <h2>Chatbot & Support</h2>
      <p>Get instant answers to your energy-related questions or connect with our support team for personalized assistance.</p>
      <hr>
      <div class="chatbot-box">
        <img src="chtp.jpg" alt="Chatbot" class="bot-img">
        <h3>Ask me anything about your energy usage</h3>
        <p>I can help you with your energy consumption, devices, and more.</p>
        <div class="chat-input">
          <input type="text" placeholder="Type your question here...">
          <button type="button" class="mic-btn">ðŸŽ¤</button>
          <label for="fileUpload" class="file-btn">ðŸ“Ž</label>
          <input type="file" id="fileUpload" style="display:none">
          <button class="send">âž¤</button>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <div class="support-card">
        <h3>Contact Support</h3>
        <a href="tel:+123456789" class="support-link">
          <p><img src="phonee.svg" alt="Phone" style="width:40px;"> <span class="label">Phone Support</span></p>
          <small>Mon-Fri, 9am-6pm</small>
        </a>
        <a href="mailto:support@example.com" class="support-link">
          <p><img src="email.svg" alt="Email" style="width:40px;"> <span class="label">Email Support</span></p>
          <small>Response within 24h</small>
        </a>
      </div>

      <div class="support-card">
        <h3>Resources</h3>
        <a href="#" class="support-link">
          <p><img src="faq.svg" alt="FAQ" style="width:40px;"> <span class="label">FAQ</span></p>
          <small>Common questions</small>
        </a>
        <a href="#" class="support-link">
          <p><img src="help.svg" alt="Help Center" style="width:40px;"> <span class="label">Help Center</span></p>
          <small>Knowledge base</small>
        </a>
      </div>
    </div>
  </div>
</body>

    
<script>
const chatInput = document.querySelector(".chat-input");
const input = chatInput.querySelector("input[type=text]");
const sendBtn = chatInput.querySelector(".send");
const userName = localStorage.getItem("userName") || "admin";
const userEmail = localStorage.getItem("userEmail") || "admin@domain.com";
document.querySelector(".admin-email").textContent = userEmail;

// CrÃ©er un conteneur de messages et l'insÃ©rer avant .chat-input
const messageContainer = document.createElement("div");
messageContainer.classList.add("chat-messages");
chatInput.parentNode.insertBefore(messageContainer, chatInput);

function addMessage(content, sender = "user") {
    const msg = document.createElement("div");
    msg.classList.add("chat-message", sender);

    let htmlContent = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

    htmlContent = htmlContent.replace(/\n/g, '<br>');

    msg.innerHTML = htmlContent;
    messageContainer.appendChild(msg);
    messageContainer.scrollTop = messageContainer.scrollHeight;
}

async function sendQuestion() {
    const question = input.value.trim();
    if (!question) return;

    addMessage(question, "user");
    input.value = "";

    try {
        const response = await fetch("http://localhost:8000/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
        });

        const data = await response.json();
        console.log(data.answer);
        if (data.answer) {
            addMessage(data.answer, "bot");
        } else {
            addMessage("Erreur lors de la rÃ©ponse.", "bot");
        }
    } catch (err) {
        console.error(err);
        addMessage("Erreur serveur.", "bot");
    }
}

sendBtn.addEventListener("click", sendQuestion);
input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendQuestion();
});
</script>

<style>
.chat-messages {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    height: 300px; /* Ajuste la hauteur */
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 10px;
    background-color: #fff;
}

.chat-message {
    max-width: 75%;
    padding: 8px 12px;
    margin: 5px 0;
    border-radius: 15px;
    word-wrap: break-word;
}

.chat-message.user {
    background-color: #007bff;
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 0;

}

.chat-message.bot {
    background-color: #f1f1f1;
    color: #333;
    align-self: flex-start;  
    border-bottom-left-radius: 0;
    text-align: left;        
}

</style>